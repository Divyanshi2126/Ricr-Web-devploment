<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QR Food Ordering with Payment & Invoice</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap & Fonts -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <!-- QR Scanner & Razorpay & jsPDF -->
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body { 
      font-family: 'Poppins', sans-serif; 
      background: linear-gradient(135deg, #667eea, #764ba2); 
      min-height: 100vh; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      padding: 20px;
    }
    .card { 
      border-radius: 20px; 
      box-shadow: 0 20px 50px rgba(0,0,0,0.25); 
      animation: fadeIn 0.6s ease; 
      max-width: 400px;
      width: 100%;
    }
    @keyframes fadeIn { 
      from {opacity:0; transform:translateY(20px)} 
      to {opacity:1; transform:translateY(0)} 
    }
    .hidden { display: none; }
    .brand { font-weight: 700; color: #facc15; font-size: 1.8rem; }
    .price { font-size: 1.3rem; font-weight: 600; color: #16a34a; }
    .btn-qr { background-color: #fbbf24; color: #000; font-weight: 600; }
    .receipt { white-space: pre-line; background: #fff; padding: 15px; border-radius: 10px; }
    input, select { border-radius: 10px; }
    button { border-radius: 10px; }
  </style>
</head>
<body>

<div class="mx-auto " style="width: 500PX;">

  <!-- Role Selection -->
  <div class="card p-4 text-center" id="roleCard">
    <h3 class="brand">ğŸ½ QR Food System</h3>
    <p class="text-muted">Choose Login Type</p>
    <button class="btn btn-primary w-100 mt-2" onclick="showStudentLogin()">Student Login</button>
    <button class="btn btn-dark w-100 mt-2" onclick="showAdminLogin()">Admin Login</button>
  </div>

  <!-- Student Login -->
  <div class="card p-4 hidden" id="studentLoginCard">
    <h4 class="text-center">ğŸ“ Student Login</h4>
    <input type="text" id="studentName" class="form-control mt-3" placeholder="Enter your name">
    <button class="btn btn-primary w-100 mt-3" onclick="studentLogin()">Continue</button>
    <button class="btn btn-link" onclick="backToRole()">â¬… Back</button>
  </div>

  <!-- Admin Login -->
  <div class="card p-4 hidden" id="adminLoginCard">
    <h4 class="text-center">ğŸ” Admin Login</h4>
    <input type="text" id="adminUser" class="form-control mt-3" placeholder="Admin Username">
    <input type="password" id="adminPass" class="form-control mt-2" placeholder="Password">
    <button class="btn btn-dark w-100 mt-3" onclick="adminLogin()">Login</button>
    <button class="btn btn-link" onclick="backToRole()">â¬… Back</button>
  </div>

  <!-- Student Menu -->
  <div class="card p-4 hidden" id="menuCard">
    <h4 class="text-center">Welcome, <span id="studentWelcome"></span> ğŸ‘‹</h4>
    <label class="mt-3">Select Food Item</label>
    <select id="food" class="form-select" onchange="updateTotal()">
      <option value="0">-- Select --</option>
      <option value="120">ğŸ” Burger</option>
      <option value="200">ğŸ• Pizza</option>
      <option value="150">ğŸ¥ª Sandwich</option>
      <option value="80">â˜• Coffee</option>
    </select>
    <label class="mt-2">Quantity</label>
    <input type="number" id="quantity" class="form-control" value="1" min="1" onchange="updateTotal()">
    <div class="price mt-3">Total: â‚¹ <span id="totalPrice">0</span></div>
    <button class="btn btn-success w-100 mt-3" onclick="payOrder()">Pay & Place Order</button>
    <button class="btn btn-qr w-100 mt-2" onclick="scanQR()">Scan QR Code</button>
  </div>

  <!-- Admin Dashboard -->
  <div class="card p-4 hidden" id="adminCard">
    <h4 class="text-center">ğŸ“Š Admin Dashboard</h4>
    <table class="table table-bordered mt-3">
      <thead class="table-dark">
        <tr><th>Student</th><th>Item</th><th>Quantity</th><th>Price</th></tr>
      </thead>
      <tbody id="orderTable"></tbody>
    </table>
    <div class="text-end fw-bold mt-2">Total Sales: â‚¹ <span id="totalSales">0</span></div>
    <button class="btn btn-secondary w-100 mt-2" onclick="logoutAdmin()">Logout</button>
  </div>

  <!-- Receipt Card -->
  <div class="card p-4 hidden" id="receiptCard">
    <h4 class="text-center">ğŸ§¾ Order Receipt</h4>
    <div class="receipt mt-3" id="receiptContent"></div>
    <button class="btn btn-secondary w-100 mt-3" onclick="backToMenu()">Back to Menu</button>
  </div>

  <!-- QR Scanner -->
  <div class="card p-4 hidden" id="qrScannerCard">
    <h4 class="text-center">ğŸ“· QR Code Scanner</h4>
    <div id="qr-reader" style="width:100%;"></div>
    <button class="btn btn-secondary w-100 mt-3" onclick="backToMenu()">Cancel</button>
  </div>

</div>


<script>
  // Default admin credentials
  if(!localStorage.getItem('adminUser')) { 
    localStorage.setItem('adminUser','admin'); 
    localStorage.setItem('adminPass','1234'); 
  }

  

  function showStudentLogin(){ toggle('roleCard','studentLoginCard'); }
  function showAdminLogin(){ toggle('roleCard','adminLoginCard'); }
  function backToRole(){ hideAll(); roleCard.classList.remove('hidden'); }

  function studentLogin(){
    const name = studentName.value.trim();
    if(!name) return alert('Enter your name');
    localStorage.setItem('student', name);
    studentWelcome.innerText = name;
    toggle('studentLoginCard','menuCard');
    updateTotal();
  }

  function adminLogin(){
    const adminUserStored = localStorage.getItem('adminUser');
    const adminPassStored = localStorage.getItem('adminPass');
    if(adminUser.value === adminUserStored && adminPass.value === adminPassStored){
      toggle('adminLoginCard','adminCard');
      loadOrders();
    } else alert('Invalid admin credentials');
  }

  function updateTotal(){
    const price = parseInt(food.value);
    const qty = parseInt(quantity.value);
    totalPrice.innerText = (price * qty) || 0;
  }

  function payOrder(){
    const amount = parseInt(totalPrice.innerText) * 100;
    if(amount === 0) return alert('Select food and quantity');

    const options = {
      key: 'rzp_test_1DP5mmOlF5G5ag',
      amount: amount,
      currency: 'INR',
      name: 'QR Food Order',
      description: 'Food Payment',
      handler: function(response){
        placeOrder();
      },
      theme: { color: '#F37254' }
    };
    const rzp = new Razorpay(options);
    rzp.open();
  }

  function placeOrder(){
    const orders = JSON.parse(localStorage.getItem('orders')||'[]');
    const order = { 
      student: localStorage.getItem('student'), 
      food: food.options[food.selectedIndex].text, 
      quantity: quantity.value, 
      price: totalPrice.innerText 
    };
    orders.push(order);
    localStorage.setItem('orders', JSON.stringify(orders));

    // Display receipt
    receiptContent.innerText = `Student: ${order.student}\nItem: ${order.food}\nQuantity: ${order.quantity}\nTotal: â‚¹${order.price}\nDate: ${new Date().toLocaleString()}`;
    toggle('menuCard','receiptCard');

    // Generate Professional PDF Invoice
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    // Header
    doc.setFontSize(18);
    doc.setFont('helvetica', 'bold');
    doc.text("ğŸ½ QR Food System Invoice", 105, 20, {align: 'center'});
    
    doc.setFontSize(12);
    doc.setFont('helvetica', 'normal');
    doc.text(`Student: ${order.student}`, 20, 40);
    doc.text(`Date: ${new Date().toLocaleString()}`, 20, 50);

    // Table
    const startY = 60;
    doc.autoTable({
      startY,
      head: [['Item', 'Quantity', 'Price (â‚¹)']],
      body: [[order.food, order.quantity, order.price]],
      theme: 'grid',
      headStyles: { fillColor: [103, 58, 183], textColor: 255, halign: 'center' },
      bodyStyles: { halign: 'center' },
    });

    doc.text(`Total: â‚¹${order.price}`, 20, startY + 30);
    doc.setFont('helvetica', 'italic');
    doc.text("Thank you for your order!", 105, startY + 50, {align: 'center'});

    doc.save(`Invoice_${order.student}_${new Date().getTime()}.pdf`);
  }

  function loadOrders(){
    orderTable.innerHTML='';
    const orders = JSON.parse(localStorage.getItem('orders')||'[]');
    let total=0;
    orders.forEach(o=>{
      orderTable.innerHTML += `<tr><td>${o.student}</td><td>${o.food}</td><td>${o.quantity}</td><td>â‚¹${o.price}</td></tr>`;
      total += parseInt(o.price);
    });
    totalSales.innerText = total;
  }

  function logoutAdmin(){ hideAll(); roleCard.classList.remove('hidden'); }
  function backToMenu(){ toggle('receiptCard','menuCard'); }

  function toggle(hideId, showId){ hideAll(); document.getElementById(showId).classList.remove('hidden'); }
  function hideAll(){ document.querySelectorAll('.card').forEach(c=>c.classList.add('hidden')); }

  function scanQR(){
    toggle('menuCard','qrScannerCard');
    const qrScanner = new Html5Qrcode("qr-reader");
    qrScanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 },
      (decodedText) => { alert('QR Scanned: '+decodedText); qrScanner.stop(); backToMenu(); },
      (errorMessage) => {}
    ).catch(err=>console.log(err));
  }
</script>
<!-- Include QR code library -->
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<div id="qrcode"></div>

<script>
  // The URL users will open after scanning
  const url = "http://127.0.0.1:5500/miniproject/index.html";

  // Generate QR code
  QRCode.toCanvas(document.getElementById('qrcode'), url, function (error) {
    if (error) console.error(error);
    console.log('QR code generated!');
  });
</script>


<!-- jsPDF AutoTable plugin -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

</body>
</html>
